<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Driver Routes</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root{
--bg-color:var(--tg-theme-bg-color,#fff);
--text-color:var(--tg-theme-text-color,#000);
--hint-color:var(--tg-theme-hint-color,#888);
--button-color:var(--tg-theme-button-color,#2481cc);
--button-text:var(--tg-theme-button-text-color,#fff);
--secondary-bg:var(--tg-theme-secondary-bg-color,#f0f0f0);
}
body{
font-family:Roboto,sans-serif;
background:var(--bg-color);
color:var(--text-color);
margin:0;
padding:16px;
user-select:none;
}
.header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:16px;
}
.route-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;
}
.route-card{
background:var(--secondary-bg);
padding:20px;
border-radius:14px;
text-align:center;
cursor:pointer;
font-size:16px;
}
.route-card:active{transform:scale(.96);}
.badge{
margin-top:6px;
display:inline-block;
background:var(--button-color);
color:var(--button-text);
padding:4px 10px;
border-radius:12px;
font-size:12px;
}
.page{display:none;}
.page.active{display:block;}
.address-item{
background:var(--secondary-bg);
padding:18px;
border-radius:12px;
margin-bottom:10px;
display:flex;
justify-content:space-between;
align-items:center;
font-size:16px;
cursor:pointer;
}
.btn{
width:100%;
padding:18px;
border:none;
border-radius:12px;
background:var(--button-color);
color:var(--button-text);
font-size:18px;
font-weight:600;
margin-top:12px;
}
.btn-light{
background:var(--secondary-bg);
color:var(--text-color);
}
</style>
</head>

<body>

<!-- MAIN -->
<div id="main-page" class="page active">
  <div class="header">
    <h1>–ú–∞—Ä—à—Ä—É—Ç—ã</h1>
    <span id="user-name" style="font-size:12px;opacity:.6"></span>
  </div>
  <div class="route-grid" id="route-grid"></div>
</div>

<!-- ROUTE -->
<div id="route-page" class="page">
  <h2 id="route-title"></h2>
  <div id="address-list"></div>
  <button class="btn btn-light" onclick="showPage('main-page')">–ù–∞–∑–∞–¥</button>
</div>

<!-- DETAILS -->
<div id="details-page" class="page">
  <h2 id="addr-name"></h2>
  <p id="addr-info" style="color:var(--hint-color)"></p>

  <button class="btn" onclick="goNav()">üß≠ –û—Ç–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä</button>
  <button class="btn btn-light" onclick="showPage('route-page')">–ù–∞–∑–∞–¥ –∫ –º–∞—Ä—à—Ä—É—Ç—É</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

/* ===== DATA ===== */
let data = [
  { id: 7701, route: 77, name: "–ö—Ä–∞—Å–Ω–æ–ø—É—Ç–∏–ª–æ–≤—Å–∫–∞—è 20", coords: "" },
  { id: 7702, route: 77, name: "–ö—Ä–∞—Å–Ω–æ–ø—É—Ç–∏–ª–æ–≤—Å–∫–∞—è 12", coords: "" },
  { id: 7703, route: 77, name: "–°—Ç–∞—á–µ–∫ 74/3", coords: "" },
  { id: 7704, route: 77, name: "–°—Ç–∞—á–µ–∫ 55", coords: "" },
  { id: 7705, route: 77, name: "–ú–∞—Ä—à–∞–ª–∞ –ì–æ–≤–æ—Ä–æ–≤–∞ 11/3", coords: "" },
  { id: 7706, route: 77, name: "–ú–∞—Ä—à–∞–ª–∞ –ì–æ–≤–æ—Ä–æ–≤–∞ 17", coords: "" },
  { id: 7707, route: 77, name: "–ú–∞—Ä—à–∞–ª–∞ –ì–æ–≤–æ—Ä–æ–≤–∞ 14", coords: "" },
  { id: 7708, route: 77, name: "–ê–≤—Ç–æ–≤—Å–∫–∞—è 33", coords: "" },
  { id: 7709, route: 77, name: "–í–∞—Å–∏ –ê–ª–µ–∫—Å–µ–µ–≤–∞ 26", coords: "" },
  { id: 7710, route: 77, name: "–¢—Ä–µ—Ñ–æ–ª–µ–≤–∞ 9–∫2", coords: "" },
  { id: 7711, route: 77, name: "–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å—Å–∫–∞—è 29", coords: "" },
  { id: 7712, route: 77, name: "–°—Ç–∞—á–µ–∫ 27", coords: "" },
  { id: 7713, route: 77, name: "–°—Ç–∞—á–µ–∫ 41", coords: "" },
  { id: 7714, route: 77, name: "–°—Ç–∞—á–µ–∫ 47", coords: "" },
  { id: 7715, route: 77, name: "–°—Ç–∞—á–µ–∫ 57", coords: "" }
];

let currentRoute = null;
let currentItem = null;

/* ===== INIT ===== */
function init(){
  document.getElementById('user-name').innerText =
    tg.initDataUnsafe?.user?.first_name || '–í–æ–¥–∏—Ç–µ–ª—å';
  renderRoutes();
}

/* ===== ROUTES ===== */
function renderRoutes(){
  const grid = document.getElementById('route-grid');
  grid.innerHTML = '';

  const routes = [...new Set(data.map(d => d.route))];
  routes.forEach(r => {
    const count = data.filter(d => d.route === r).length;
    grid.innerHTML += `
      <div class="route-card" onclick="openRoute(${r})">
        <div style="font-size:28px">üöö</div>
        <div>–ú–∞—Ä—à—Ä—É—Ç ${r}</div>
        <span class="badge">${count} —Ç–æ—á–µ–∫</span>
      </div>
    `;
  });
}

function openRoute(r){
  currentRoute = r;
  document.getElementById('route-title').innerText = `–ú–∞—Ä—à—Ä—É—Ç ‚Ññ${r}`;

  const list = document.getElementById('address-list');
  list.innerHTML = '';

  data
    .filter(d => d.route === r)
    .forEach(i => {
      list.innerHTML += `
        <div class="address-item" onclick="openDetails(${i.id})">
          <span>${i.coords ? 'üìç' : 'üè†'} ${i.name}</span>
          <span>‚ùØ</span>
        </div>
      `;
    });

  showPage('route-page');
}

/* ===== DETAILS ===== */
function openDetails(id){
  currentItem = data.find(d => d.id === id);
  document.getElementById('addr-name').innerText = currentItem.name;
  document.getElementById('addr-info').innerText =
    currentItem.coords ? '–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º' : '–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∞–¥—Ä–µ—Å—É';

  showPage('details-page');
}

function goNav(){
  if(currentItem.coords){
    const [lat, lon] = currentItem.coords.split(',');
    window.open(`https://yandex.ru/maps/?rtext=~${lat},${lon}`);
  } else {
    window.open(`https://yandex.ru/maps/?text=${encodeURIComponent(currentItem.name)}`);
  }
}

/* ===== NAV ===== */
function showPage(id){
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

init();
</script>

</body>
</html>