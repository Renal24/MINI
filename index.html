<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–õ–ö-–°–ú–ê–†–¢ | –í–æ–¥–∏—Ç–µ–ª—å</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f8f9fb;
            --card-bg: #ffffff;
            --text-main: #202124;
            --text-secondary: #70757a;
            --accent-color: #8e44ad;
            --accent-light: #f4ecf7;
            --border-color: #f0f0f0;
            --nav-blue: #007aff;
            --ok-green: #2ecc71;
            --warn-yellow: #f1c40f;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0; padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        .container { padding: 16px; max-width: 600px; margin: 0 auto; }

        /* Header */
        .app-header {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            background: white;
            position: sticky;
            top: 0; z-index: 100;
            border-bottom: 1px solid var(--border-color);
        }

        .app-header .title {
            flex-grow: 1;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
        }

        /* Route Cards */
        .route-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }

        .route-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .route-number { font-size: 20px; font-weight: 700; }
        
        .barcode-badge { 
            padding: 6px 12px; 
            border-radius: 8px; 
            font-weight: 700; 
            font-size: 14px; 
        }
        .bg-green { background: #e8f9ef; color: var(--ok-green); }
        .bg-yellow { background: #fef9e7; color: #d4ac0d; }

        .route-stats { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }

        .section-label { font-size: 12px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin: 12px 0 6px 0; }
        .address-text { font-size: 15px; color: var(--text-main); line-height: 1.4; font-weight: 500; }

        /* Buttons */
        .btn-main {
            background: var(--accent-color);
            color: white;
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 18px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-details {
            background: var(--accent-light);
            color: var(--accent-color);
            margin-top: 15px;
            border: none;
            padding: 12px;
            border-radius: 12px;
            width: 100%;
            font-weight: 600;
        }

        .basket-item {
            display: flex;
            gap: 12px;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .step-number {
            width: 24px; height: 24px;
            background: var(--accent-light);
            color: var(--accent-color);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: 700; flex-shrink: 0;
        }

        .page { display: none; }
        .page.active { display: block; }

        .footer-action {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; padding: 16px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }
        .route-summary-text {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 600;
        }
        .pb-large { padding-bottom: 150px; }
    </style>
</head>
<body>

    <div id="main-page" class="page active">
        <div class="app-header">
            <div class="title">–ì–æ—Ç–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã</div>
        </div>
        <div class="container" id="routes-list"></div>
    </div>

    <div id="details-page" class="page">
        <div class="app-header">
            <div class="title" id="details-title">–ú–∞—Ä—à—Ä—É—Ç</div>
        </div>
        <div class="container pb-large">
            <div class="route-card">
                <div class="section-label">–ü–æ–≥—Ä—É–∑–∫–∞ (–°–∫–ª–∞–¥)</div>
                <div class="address-text" id="loading-addr" style="color: var(--nav-blue);">üìç –®—É—à–∞—Ä—ã, –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, 143</div>
                
                <div class="section-label" id="points-count">–†–∞–∑–≥—Ä—É–∑–∫–∞ (0 —Ç–æ—á–µ–∫)</div>
                <div id="points-list"></div>
            </div>
        </div>
        <div class="footer-action">
            <div class="route-summary-text" id="footer-stats">–í–µ—Å—å –º–∞—Ä—à—Ä—É—Ç: -- –∫–º ‚Ä¢ -- —á</div>
            <button class="btn-main" onclick="buildFullRoute()">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç —Ü–µ–ª–∏–∫–æ–º</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const routesData = [
            {
                id: 9782,
                barcode: "1257 –®–ö",
                barcodeClass: "bg-green",
                dist: "444 –∫–º",
                time: "16 —á 25 –º",
                loading: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ø–æ—Å—ë–ª–æ–∫ –®—É—à–∞—Ä—ã, –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, 143",
                points: [
                    { addr: "–í—ã–±–æ—Ä–≥, –ü–æ–≥—Ä–∞–Ω–∏—á–Ω–∞—è —É–ª–∏—Ü–∞ 4", id: "50007868" },
                    { addr: "–í—ã–±–æ—Ä–≥, –í–æ–∫–∑–∞–ª—å–Ω–∞—è —É–ª–∏—Ü–∞ 4", id: "50150055" },
                    { addr: "–≥. –í—ã–±–æ—Ä–≥, —É–ª –†–æ—Å—Ç–æ–≤—Å–∫–∞—è —É–ª–∏—Ü–∞ –¥. 5", id: "1727" },
                    { addr: "–í—ã–±–æ—Ä–≥, —É–ª–∏—Ü–∞ –ú–∏—Ä–∞ 4", id: "147112" },
                    { addr: "–í—ã–±–æ—Ä–≥, –ü—Ä–æ—Å–ø–µ–∫—Ç –õ–µ–Ω–∏–Ω–∞ 18", id: "50043124" },
                    { addr: "–í—ã–±–æ—Ä–≥, —É–ª –ö—Ä–µ–ø–æ—Å—Ç–Ω–∞—è, –¥. 30", id: "50066503" },
                    { addr: "–í—ã–±–æ—Ä–≥, –ü—Ä–æ—Å–ø–µ–∫—Ç –°—É–≤–æ—Ä–æ–≤–∞ 7", id: "50034846" },
                    { addr: "–≥. –í—ã–±–æ—Ä–≥, –í—ã–±–æ—Ä–≥—Å–∫–∞—è —É–ª–∏—Ü–∞ 40", id: "107213" },
                    { addr: "–≥. –í—ã–±–æ—Ä–≥, –í—ã–±–æ—Ä–≥—Å–∫–∞—è –£–ª–∏—Ü–∞ 6", id: "157142" },
                    { addr: "–í—ã–±–æ—Ä–≥, —É–ª–∏—Ü–∞ –°–µ–≤–µ—Ä–Ω—ã–π –í–∞–ª 2", id: "50138637" }
                ]
            },
            {
                id: 9785,
                barcode: "542 –®–ö",
                barcodeClass: "bg-yellow",
                dist: "90 –∫–º",
                time: "4 —á 1 –º",
                loading: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ø–æ—Å—ë–ª–æ–∫ –®—É—à–∞—Ä—ã, –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ, 143",
                points: [
                    { addr: "–ì–∞—Ç—á–∏–Ω–∞, –ø—Ä–æ—Å–ø–µ–∫—Ç 25 –û–∫—Ç—è–±—Ä—è, 10", id: "10293" },
                    { addr: "–ì–∞—Ç—á–∏–Ω–∞, —É–ª. –°–æ–±–æ—Ä–Ω–∞—è, 5", id: "11044" }
                ]
            }
        ];

        let selectedRoute = null;

        function renderMain() {
            const container = document.getElementById('routes-list');
            container.innerHTML = '';
            routesData.forEach(route => {
                const div = document.createElement('div');
                div.className = 'route-card';
                div.innerHTML = `
                    <div class="route-header">
                        <div class="route-number">–ú–∞—Ä—à—Ä—É—Ç ‚Ññ${route.id}</div>
                        <div class="barcode-badge ${route.barcodeClass}">${route.barcode}</div>
                    </div>
                    <div class="route-stats">${route.dist} ‚Ä¢ ${route.time}</div>
                    <div class="section-label">–ü–æ–≥—Ä—É–∑–∫–∞</div>
                    <div class="address-text">${route.loading}</div>
                    <button class="btn-details" onclick="openDetails(${route.id})">–î–µ—Ç–∞–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞</button>
                `;
                container.appendChild(div);
            });
        }

        function openDetails(id) {
            selectedRoute = routesData.find(r => r.id === id);
            document.getElementById('details-title').innerText = '–ú–∞—Ä—à—Ä—É—Ç ‚Ññ' + id;
            document.getElementById('points-count').innerText = `–†–∞–∑–≥—Ä—É–∑–∫–∞ (${selectedRoute.points.length} —Ç–æ—á–µ–∫)`;
            document.getElementById('footer-stats').innerText = `–í–µ—Å—å –º–∞—Ä—à—Ä—É—Ç: ${selectedRoute.dist} ‚Ä¢ ${selectedRoute.time}`;
            
            const list = document.getElementById('points-list');
            list.innerHTML = '';
            selectedRoute.points.forEach((p, i) => {
                const item = document.createElement('div');
                item.className = 'basket-item';
                item.onclick = () => openMap(p.addr);
                item.innerHTML = `
                    <div class="step-number">${i + 1}</div>
                    <div style="flex-grow: 1">
                        <div class="address-text">${p.addr}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">ID ${p.id}</div>
                    </div>
                    <div style="color: var(--text-secondary); font-size: 18px;">üìç</div>
                `;
                list.appendChild(item);
            });

            showPage('details-page');
        }

        function openMap(addr) {
            tg.HapticFeedback.impactOccurred('light');
            tg.openLink(`https://yandex.ru/maps/?text=${encodeURIComponent(addr)}`);
        }

        function buildFullRoute() {
            if (!selectedRoute) return;
            tg.HapticFeedback.impactOccurred('medium');
            // –°–æ–±–∏—Ä–∞–µ–º —Å–∫–ª–∞–¥ + –≤—Å–µ —Ç–æ—á–∫–∏ —Ä–∞–∑–≥—Ä—É–∑–∫–∏
            const allAddrs = [selectedRoute.loading, ...selectedRoute.points.map(p => p.addr)];
            const routeString = allAddrs.map(a => encodeURIComponent(a)).join('~');
            // –†–µ–∂–∏–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ –≤ –Ø–Ω–¥–µ–∫—Å–µ
            tg.openLink(`https://yandex.ru/maps/?mode=routes&rtext=${routeString}`);
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            if (pageId === 'main-page') {
                tg.BackButton.hide();
            } else {
                tg.BackButton.show();
            }
            window.scrollTo(0, 0);
        }

        tg.BackButton.onClick(() => showPage('main-page'));

        renderMain();
    </script>
</body>
</html>
