<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Logistics App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root{
--bg-color:var(--tg-theme-bg-color,#fff);
--text-color:var(--tg-theme-text-color,#000);
--hint-color:var(--tg-theme-hint-color,#999);
--button-color:var(--tg-theme-button-color,#2481cc);
--button-text:var(--tg-theme-button-text-color,#fff);
--secondary-bg:var(--tg-theme-secondary-bg-color,#f0f0f0);
}
body{
font-family:Roboto,sans-serif;
background:var(--bg-color);
color:var(--text-color);
margin:0;
padding:16px;
user-select:none;
}
.header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:16px;
}
.route-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;
}
.route-card{
background:var(--secondary-bg);
padding:16px;
border-radius:12px;
text-align:center;
cursor:pointer;
}
.route-card:active{transform:scale(.96);}
.badge{
background:var(--button-color);
color:var(--button-text);
padding:2px 8px;
border-radius:10px;
font-size:12px;
}
.page{display:none;}
.page.active{display:block;}
.address-item{
background:var(--secondary-bg);
padding:12px;
border-radius:10px;
margin-bottom:8px;
display:flex;
justify-content:space-between;
}
.btn{
width:100%;
margin-top:8px;
padding:10px;
border:none;
border-radius:8px;
background:var(--button-color);
color:var(--button-text);
font-weight:500;
}
.btn-danger{background:#ff4d4d;}
.btn-light{
background:var(--secondary-bg);
color:var(--text-color);
}
</style>
</head>

<body>

<!-- MAIN -->
<div id="main-page" class="page active">
<div class="header">
<h1>–ú–∞—Ä—à—Ä—É—Ç—ã</h1>
<span id="user-name" style="font-size:12px;opacity:.6"></span>
</div>

<button class="btn" onclick="addRoute()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
<div class="route-grid" id="route-grid"></div>
</div>

<!-- ROUTE -->
<div id="route-page" class="page">
<h2 id="route-title"></h2>
<button class="btn" onclick="addAddress()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å</button>
<div id="address-list"></div>
<button class="btn btn-light" onclick="showPage('main-page')">–ù–∞–∑–∞–¥</button>
</div>

<!-- DETAILS -->
<div id="details-page" class="page">
<h2 id="addr-name"></h2>
<p id="addr-info" style="color:var(--hint-color)"></p>

<div id="nav-button-container"></div>

<button class="btn" onclick="editName()">‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
<button class="btn" onclick="editCoords()">üìç –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button>
<button class="btn" onclick="removeCoords()">‚ùå –£–¥–∞–ª–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button>
<button class="btn" onclick="changeRoute()">üîÅ –°–º–µ–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
<button class="btn btn-danger" onclick="deleteItem()">üóë –£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å</button>
<button class="btn btn-light" onclick="showPage('route-page')">–ù–∞–∑–∞–¥</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

let data = JSON.parse(localStorage.getItem('logistics_data')) || [];
let currentRoute=null;
let currentItem=null;

function save(){
localStorage.setItem('logistics_data',JSON.stringify(data));
}

function init(){
document.getElementById('user-name').innerText=tg.initDataUnsafe?.user?.first_name||'–î–∏—Å–ø–µ—Ç—á–µ—Ä';
renderRoutes();
}

function renderRoutes(){
const grid=document.getElementById('route-grid');
grid.innerHTML='';
[...new Set(data.map(d=>d.route))].forEach(r=>{
const count=data.filter(d=>d.route===r).length;
grid.innerHTML+=`
<div class="route-card" onclick="openRoute(${r})">
<div>${count?'üöö':'üì¶'}</div>
<div>–ú–∞—Ä—à—Ä—É—Ç ${r}</div>
<span class="badge">${count} —Ç–æ—á.</span>
</div>`;
});
}

function addRoute(){
const r=prompt('–ù–æ–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∞');
if(!r)return;
data.push({id:Date.now(),route:+r,name:'–ù–æ–≤—ã–π –∞–¥—Ä–µ—Å',coords:''});
save();
renderRoutes();
}

function openRoute(r){
currentRoute=r;
document.getElementById('route-title').innerText='–ú–∞—Ä—à—Ä—É—Ç ‚Ññ'+r;
const list=document.getElementById('address-list');
list.innerHTML='';
data.filter(d=>d.route===r).forEach(i=>{
list.innerHTML+=`
<div class="address-item" onclick="openDetails(${i.id})">
<span>${i.coords?'üìç':'üè†'} ${i.name}</span><span>‚ùØ</span>
</div>`;
});
showPage('route-page');
}

function addAddress(){
const name=prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞');
if(!name)return;
data.push({id:Date.now(),route:currentRoute,name,coords:''});
save();
openRoute(currentRoute);
}

function openDetails(id){
currentItem=data.find(d=>d.id===id);
document.getElementById('addr-name').innerText=currentItem.name;
document.getElementById('addr-info').innerText=currentItem.coords||'–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ –∑–∞–¥–∞–Ω—ã';

const nav=document.getElementById('nav-button-container');
nav.innerHTML='';
if(currentItem.coords){
const [lat,lon]=currentItem.coords.split(',');
nav.innerHTML=`<button class="btn" onclick="window.open('https://yandex.ru/maps/?rtext=~${lat},${lon}')">–ù–∞–≤–∏–≥–∞—Ç–æ—Ä</button>`;
}
showPage('details-page');
}

function editName(){
const n=prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ',currentItem.name);
if(!n)return;
currentItem.name=n;
save();
openDetails(currentItem.id);
}

function editCoords(){
const c=prompt('lat,lon',currentItem.coords);
if(!c)return;
currentItem.coords=c;
save();
openDetails(currentItem.id);
}

function removeCoords(){
currentItem.coords='';
save();
openDetails(currentItem.id);
}

function changeRoute(){
const r=prompt('–ù–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç');
if(!r)return;
currentItem.route=+r;
save();
showPage('main-page');
renderRoutes();
}

function deleteItem(){
tg.showConfirm('–£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å?',ok=>{
if(!ok)return;
data=data.filter(d=>d.id!==currentItem.id);
save();
openRoute(currentRoute);
});
}

function showPage(id){
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
document.getElementById(id).classList.add('active');
}

init();
</script>

</body>
</html>